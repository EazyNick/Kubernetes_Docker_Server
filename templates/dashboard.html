{% extends "base.html" %}
{% block title %}대시보드 - 컨테이너 모니터링{% endblock %}
{% block breadcrumb %}대시보드{% endblock %}
{% block content %}

<div class="row mb-4">
  <div class="col-12">
    <div class="dashboard-card">
      <div class="dashboard-card-header">
        <div class="dashboard-card-title">
          <i class="fas fa-heartbeat"></i>
          클러스터 상태
        </div>
        <div class="dashboard-card-subtitle">실시간 인프라 건강성 모니터링</div>
      </div>
    </div>
  </div>
</div>

<div class="metric-grid">
  <div class="metric-card">
    <div class="metric-card-header">
      <div class="metric-icon primary">
        <i class="fas fa-cubes"></i>
      </div>
    </div>
    <div class="metric-value" id="totalContainers">-</div>
    <div class="metric-label">전체 컨테이너</div>
    <div class="metric-change positive">
      <i class="fas fa-arrow-up"></i>
      <span id="totalContainersChange">-</span>
    </div>
  </div>

  <div class="metric-card">
    <div class="metric-card-header">
      <div class="metric-icon success">
        <i class="fas fa-play-circle"></i>
      </div>
    </div>
    <div class="metric-value" id="runningContainers">-</div>
    <div class="metric-label">실행 중</div>
    <div class="metric-change positive">
      <i class="fas fa-arrow-up"></i>
      <span id="runningContainersChange">-</span>
    </div>
  </div>

  <div class="metric-card">
    <div class="metric-card-header">
      <div class="metric-icon warning">
        <i class="fas fa-pause-circle"></i>
      </div>
    </div>
    <div class="metric-value" id="stoppedContainers">-</div>
    <div class="metric-label">중지됨</div>
    <div class="metric-change negative">
      <i class="fas fa-arrow-down"></i>
      <span id="stoppedContainersChange">-</span>
    </div>
  </div>

  <div class="metric-card">
    <div class="metric-card-header">
      <div class="metric-icon danger">
        <i class="fas fa-exclamation-circle"></i>
      </div>
    </div>
    <div class="metric-value" id="failedContainers">-</div>
    <div class="metric-label">실패</div>
    <div class="metric-change negative">
      <i class="fas fa-arrow-up"></i>
      <span id="failedContainersChange">-</span>
    </div>
  </div>
</div>

<div class="row mb-4">
  <div class="col-lg-3 col-md-6 mb-4">
    <div class="metric-card">
      <div class="metric-card-header">
        <div class="metric-icon primary">
          <i class="fas fa-server"></i>
        </div>
      </div>
      <div class="metric-value" id="dashboardActiveNodes">-</div>
      <div class="metric-label">활성 노드</div>
      <div class="metric-change positive">
        <i class="fas fa-arrow-up"></i>
        <span id="dashboardActiveNodesChange">-</span>
      </div>
    </div>
  </div>

  <div class="col-lg-3 col-md-6 mb-4">
    <div class="metric-card">
      <div class="metric-card-header">
        <div class="metric-icon warning">
          <i class="fas fa-microchip"></i>
        </div>
      </div>
      <div class="metric-value" id="dashboardAvgCpuUsage">-</div>
      <div class="metric-label">평균 CPU 사용률</div>
      <div class="metric-change positive">
        <i class="fas fa-arrow-up"></i>
        <span id="dashboardAvgCpuUsageChange">-</span>
      </div>
    </div>
  </div>

  <div class="col-lg-3 col-md-6 mb-4">
    <div class="metric-card">
      <div class="metric-card-header">
        <div class="metric-icon info">
          <i class="fas fa-memory"></i>
        </div>
      </div>
      <div class="metric-value" id="dashboardAvgMemoryUsage">-</div>
      <div class="metric-label">평균 메모리 사용률</div>
      <div class="metric-change positive">
        <i class="fas fa-arrow-up"></i>
        <span id="dashboardAvgMemoryUsageChange">-</span>
      </div>
    </div>
  </div>

  <div class="col-lg-3 col-md-6 mb-4">
    <div class="metric-card">
      <div class="metric-card-header">
        <div class="metric-icon success">
          <i class="fas fa-network-wired"></i>
        </div>
      </div>
      <div class="metric-value" id="networkTraffic">-</div>
      <div class="metric-label">네트워크 트래픽</div>
      <div class="metric-change positive">
        <i class="fas fa-arrow-up"></i>
        <span id="networkTrafficChange">-</span>
      </div>
    </div>
  </div>
</div>

<div class="row mb-4">
  <div class="col-lg-6 mb-4">
    <div class="dashboard-card">
      <div class="dashboard-card-header">
        <h5 class="dashboard-card-title">
          <i class="fas fa-microchip"></i>
          CPU 사용률
        </h5>
        <p class="dashboard-card-subtitle">최근 24시간 CPU 사용률 추이</p>
      </div>
      <div class="dashboard-card-body">
        <div class="chart-container">
          <canvas id="cpuChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-6 mb-4">
    <div class="dashboard-card">
      <div class="dashboard-card-header">
        <h5 class="dashboard-card-title">
          <i class="fas fa-memory"></i>
          메모리 사용률
        </h5>
        <p class="dashboard-card-subtitle">최근 24시간 메모리 사용률 추이</p>
      </div>
      <div class="dashboard-card-body">
        <div class="chart-container">
          <canvas id="memoryChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row mb-4">
  <div class="col-lg-6 mb-4">
    <div class="dashboard-card">
      <div class="dashboard-card-header">
        <h5 class="dashboard-card-title">
          <i class="fas fa-network-wired"></i>
          네트워크 트래픽
        </h5>
        <p class="dashboard-card-subtitle">인바운드/아웃바운드 트래픽</p>
      </div>
      <div class="dashboard-card-body">
        <div class="chart-container">
          <canvas id="networkChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-6 mb-4">
    <div class="dashboard-card">
      <div class="dashboard-card-header">
        <h5 class="dashboard-card-title">
          <i class="fas fa-hdd"></i>
          디스크 I/O
        </h5>
        <p class="dashboard-card-subtitle">디스크 읽기/쓰기 성능</p>
      </div>
      <div class="dashboard-card-body">
        <div class="chart-container">
          <canvas id="diskChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row mb-4">
  <div class="col-12">
    <div class="dashboard-card">
      <div class="dashboard-card-header">
        <h5 class="dashboard-card-title">
          <i class="fas fa-bell"></i>
          최근 알림
        </h5>
        <p class="dashboard-card-subtitle">시스템에서 발생한 최근 알림</p>
      </div>
      <div class="dashboard-card-body">
        <div class="alert-list" id="recentAlerts">
          <!-- 최근 알림이 여기에 동적으로 로드됩니다 -->
          <div class="text-center text-muted py-4">
            <i class="fas fa-spinner fa-spin me-2"></i>
            알림을 불러오는 중...
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  console.log('Dashboard page loaded');
  
  // StatsAPI가 로드될 때까지 대기
  function waitForStatsAPI() {
    if (window.StatsAPI) {
      console.log('StatsAPI loaded, updating dashboard data');
      window.StatsAPI.updateDashboardData();
      
      // 5초마다 데이터 업데이트
      setInterval(() => {
        window.StatsAPI.updateDashboardData();
      }, 5000);
    } else {
      setTimeout(waitForStatsAPI, 100);
    }
  }
  
  waitForStatsAPI();
});
</script>
{% endblock %}
