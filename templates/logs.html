<!-- 로그 관리 페이지 - 시스템 및 애플리케이션 로그를 검색하고 분석하는 페이지 -->
{% extends "base.html" %} {% block title %}로그 - 컨테이너 모니터링{% endblock
%} {% block breadcrumb %}로그{% endblock %} {% block content %}

<!-- 로그 필터 및 검색 섹션 -->
<div class="row mb-4">
  <div class="col-lg-8">
    <div class="dashboard-card">
      <div class="dashboard-card-header">
        <h5 class="dashboard-card-title">
          <i class="fas fa-filter"></i>
          로그 필터
        </h5>
        <p class="dashboard-card-subtitle">로그 검색 및 필터링 옵션</p>
      </div>
      <div class="dashboard-card-body">
        <div class="row">
          <!-- 컨테이너 선택 필터 -->
          <div class="col-md-3 mb-3">
            <label class="form-label">컨테이너</label>
            <select class="form-select">
              <option value="">모든 컨테이너</option>
              <option value="nginx-web-1">nginx-web-1</option>
              <option value="nginx-web-2">nginx-web-2</option>
              <option value="redis-cache-1">redis-cache-1</option>
              <option value="postgres-db-1">postgres-db-1</option>
              <option value="api-gateway-1">api-gateway-1</option>
            </select>
          </div>
          <!-- 로그 레벨 필터 -->
          <div class="col-md-3 mb-3">
            <label class="form-label">로그 레벨</label>
            <select class="form-select">
              <option value="">모든 레벨</option>
              <option value="info">INFO</option>
              <option value="warn">WARN</option>
              <option value="error">ERROR</option>
              <option value="debug">DEBUG</option>
            </select>
          </div>
          <!-- 시간 범위 필터 -->
          <div class="col-md-3 mb-3">
            <label class="form-label">시간 범위</label>
            <select class="form-select">
              <option value="1h">최근 1시간</option>
              <option value="6h">최근 6시간</option>
              <option value="24h" selected>최근 24시간</option>
              <option value="7d">최근 7일</option>
            </select>
          </div>
          <!-- 검색어 입력 필터 -->
          <div class="col-md-3 mb-3">
            <label class="form-label">검색어</label>
            <input
              type="text"
              class="form-control"
              placeholder="로그 내용 검색..."
            />
          </div>
        </div>
        <div class="d-flex gap-2">
          <button class="btn btn-primary">
            <i class="fas fa-search"></i> 검색
          </button>
          <button class="btn btn-outline-secondary">
            <i class="fas fa-download"></i> 내보내기
          </button>
          <button class="btn btn-outline-danger">
            <i class="fas fa-trash"></i> 로그 지우기
          </button>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-4">
    <div class="dashboard-card">
      <div class="dashboard-card-header">
        <h5 class="dashboard-card-title">
          <i class="fas fa-chart-bar"></i>
          로그 통계
        </h5>
        <p class="dashboard-card-subtitle">최근 24시간 로그 통계</p>
      </div>
      <div class="dashboard-card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <span>전체 로그</span>
          <span class="fw-bold">12,847</span>
        </div>
        <div class="d-flex justify-content-between align-items-center mb-2">
          <span class="text-success">INFO</span>
          <span class="fw-bold">10,234</span>
        </div>
        <div class="d-flex justify-content-between align-items-center mb-2">
          <span class="text-warning">WARN</span>
          <span class="fw-bold">2,156</span>
        </div>
        <div class="d-flex justify-content-between align-items-center mb-2">
          <span class="text-danger">ERROR</span>
          <span class="fw-bold">457</span>
        </div>
        <div class="d-flex justify-content-between align-items-center">
          <span class="text-info">DEBUG</span>
          <span class="fw-bold">0</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 실시간 로그 스트림 -->
<div class="dashboard-card">
  <div class="dashboard-card-header">
    <h5 class="dashboard-card-title">
      <i class="fas fa-stream"></i>
      실시간 로그 스트림
    </h5>
    <p class="dashboard-card-subtitle">실시간으로 업데이트되는 로그</p>
    <div class="d-flex gap-2 mt-2">
      <button class="btn btn-sm btn-outline-primary" id="sortByTime">
        <i class="fas fa-sort"></i> 시간순
      </button>
      <button class="btn btn-sm btn-outline-primary" id="sortByLevel">
        <i class="fas fa-sort"></i> 레벨순
      </button>
      <button class="btn btn-sm btn-outline-primary" id="sortByMessage">
        <i class="fas fa-sort"></i> 메시지순
      </button>
    </div>
  </div>
  <div class="dashboard-card-body">
    <div class="log-container" id="logContainer">
      <div class="log-entry">
        <span class="log-timestamp">14:32:15</span>
        <span class="log-level info">INFO</span>
        <span class="log-message"
          >nginx-web-1: GET /api/health HTTP/1.1 200</span
        >
      </div>
      <div class="log-entry">
        <span class="log-timestamp">14:32:14</span>
        <span class="log-level info">INFO</span>
        <span class="log-message"
          >postgres-db-1: Connection established from 172.17.0.5</span
        >
      </div>
      <div class="log-entry">
        <span class="log-timestamp">14:32:13</span>
        <span class="log-level warn">WARN</span>
        <span class="log-message"
          >redis-cache-1: Memory usage is above 80%</span
        >
      </div>
      <div class="log-entry">
        <span class="log-timestamp">14:32:12</span>
        <span class="log-level info">INFO</span>
        <span class="log-message"
          >api-gateway-1: Load balancer health check passed</span
        >
      </div>
      <div class="log-entry">
        <span class="log-timestamp">14:32:11</span>
        <span class="log-level error">ERROR</span>
        <span class="log-message"
          >nginx-web-2: Failed to connect to upstream server</span
        >
      </div>
      <div class="log-entry">
        <span class="log-timestamp">14:32:10</span>
        <span class="log-level info">INFO</span>
        <span class="log-message"
          >k8s-worker-01: Pod nginx-web-3 scheduled successfully</span
        >
      </div>
      <div class="log-entry">
        <span class="log-timestamp">14:32:09</span>
        <span class="log-level info">INFO</span>
        <span class="log-message"
          >nginx-web-1: Container health check passed</span
        >
      </div>
      <div class="log-entry">
        <span class="log-timestamp">14:32:08</span>
        <span class="log-level warn">WARN</span>
        <span class="log-message"
          >postgres-db-1: Slow query detected: 2.3s</span
        >
      </div>
      <div class="log-entry">
        <span class="log-timestamp">14:32:07</span>
        <span class="log-level info">INFO</span>
        <span class="log-message"
          >api-gateway-1: Rate limit applied to client 192.168.1.100</span
        >
      </div>
      <div class="log-entry">
        <span class="log-timestamp">14:32:06</span>
        <span class="log-level info">INFO</span>
        <span class="log-message"
          >nginx-web-2: Image pull completed for nginx:1.21</span
        >
      </div>
      <div class="log-entry">
        <span class="log-timestamp">14:32:05</span>
        <span class="log-level error">ERROR</span>
        <span class="log-message"
          >redis-cache-1: Connection timeout to master</span
        >
      </div>
      <div class="log-entry">
        <span class="log-timestamp">14:32:04</span>
        <span class="log-level info">INFO</span>
        <span class="log-message"
          >k8s-master-01: Service endpoint updated for nginx-service</span
        >
      </div>
      <div class="log-entry">
        <span class="log-timestamp">14:32:03</span>
        <span class="log-level info">INFO</span>
        <span class="log-message"
          >nginx-web-1: Backup process completed successfully</span
        >
      </div>
      <div class="log-entry">
        <span class="log-timestamp">14:32:02</span>
        <span class="log-level warn">WARN</span>
        <span class="log-message"
          >postgres-db-1: Resource limits exceeded for query</span
        >
      </div>
      <div class="log-entry">
        <span class="log-timestamp">14:32:01</span>
        <span class="log-level info">INFO</span>
        <span class="log-message">api-gateway-1: SSL certificate renewed</span>
      </div>
    </div>
  </div>
</div>

<!-- 로그 정렬 기능 JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const logContainer = document.getElementById('logContainer');
  const sortByTimeBtn = document.getElementById('sortByTime');
  const sortByLevelBtn = document.getElementById('sortByLevel');
  const sortByMessageBtn = document.getElementById('sortByMessage');
  
  let currentSort = { type: null, direction: 'asc' };

  // 시간순 정렬
  sortByTimeBtn.addEventListener('click', function() {
    toggleSort('time', this);
    sortLogs('time');
  });

  // 레벨순 정렬
  sortByLevelBtn.addEventListener('click', function() {
    toggleSort('level', this);
    sortLogs('level');
  });

  // 메시지순 정렬
  sortByMessageBtn.addEventListener('click', function() {
    toggleSort('message', this);
    sortLogs('message');
  });

  function toggleSort(type, button) {
    if (currentSort.type === type) {
      currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
    } else {
      currentSort.direction = 'asc';
      currentSort.type = type;
    }
    
    // 모든 버튼 초기화
    [sortByTimeBtn, sortByLevelBtn, sortByMessageBtn].forEach(btn => {
      btn.innerHTML = btn.innerHTML.replace(/fa-sort-(up|down)/, 'fa-sort');
    });
    
    // 현재 버튼 아이콘 업데이트
    const icon = button.querySelector('i');
    icon.className = currentSort.direction === 'asc' 
      ? 'fas fa-sort-up' 
      : 'fas fa-sort-down';
  }

  function sortLogs(sortType) {
    const logEntries = Array.from(logContainer.querySelectorAll('.log-entry'));
    
    logEntries.sort((a, b) => {
      let aValue, bValue;
      
      if (sortType === 'time') {
        aValue = a.querySelector('.log-timestamp').textContent;
        bValue = b.querySelector('.log-timestamp').textContent;
        return currentSort.direction === 'asc' 
          ? aValue.localeCompare(bValue)
          : bValue.localeCompare(aValue);
      } else if (sortType === 'level') {
        aValue = a.querySelector('.log-level').textContent;
        bValue = b.querySelector('.log-level').textContent;
        // 레벨 우선순위: ERROR > WARN > INFO > DEBUG
        const levelOrder = { 'ERROR': 4, 'WARN': 3, 'INFO': 2, 'DEBUG': 1 };
        const aOrder = levelOrder[aValue] || 0;
        const bOrder = levelOrder[bValue] || 0;
        return currentSort.direction === 'asc' 
          ? aOrder - bOrder
          : bOrder - aOrder;
      } else if (sortType === 'message') {
        aValue = a.querySelector('.log-message').textContent;
        bValue = b.querySelector('.log-message').textContent;
        return currentSort.direction === 'asc' 
          ? aValue.localeCompare(bValue)
          : bValue.localeCompare(aValue);
      }
    });

    // 정렬된 로그 엔트리들을 컨테이너에 다시 추가
    logEntries.forEach(entry => logContainer.appendChild(entry));
  }
});
</script>

{% endblock %}
